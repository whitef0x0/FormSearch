// Generated by CoffeeScript 1.3.3
(function() {
  var client, conString, pg;

  pg = require("pg");

  conString = "tcp://admin:password@localhost/forms";

  client = new pg.Client(conString);

  client.connect();

  exports.Reason = function(callback) {
    var places, query, reasons;
    query = client.query('SELECT r.name, r.rid FROM reasons as r');
    reasons = [];
    query.on("row", function(row) {
      return reasons.push(row);
    });
    query = client.query('SELECT p.name, p.city, p.pid FROM places as p');
    places = [];
    query.on("row", function(row) {
      return places.push(row);
    });
    return query.on("end", function() {
      return callback(reasons, places);
    });
  };

  exports.Upload = function(form) {
    var query;
    query = client.query("INSERT INTO forms (title, is_pediatric, place_id, reason_id) \nVALUES ('" + form.title + "', '" + form.is_ped + "', '" + form.pid + "', '" + form.rid + "');");
    return query.on("end", function() {});
  };

  exports.Search = function(callback) {
    var query, results;
    query = client.query('SELECT r.name, p.name, p.city, f.title, f.filename, f.is_pediatric\nFROM\nreasons as r, places as p, forms as f\nWHERE\nf.reason_id = r.rid AND f.place_id = p.pid');
    results = [];
    query.on("row", function(row) {
      results.push(row);
      return console.log(results);
    });
    return query.on("end", function() {
      return callback(results);
    });
  };

}).call(this);
