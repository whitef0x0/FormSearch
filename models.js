// Generated by CoffeeScript 1.6.2
(function() {
  var City, Form, Institution, Reason, client, conString, pg;

  pg = require("pg");

  conString = "tcp://admin:password@localhost/forms";

  client = new pg.Client(conString);

  client.connect();

  exports.Reason = function(callback) {
    var cities, places, query, reasons;

    query = client.query('SELECT r.name, r.id FROM reasons as r');
    reasons = [];
    query.on("row", function(row) {
      return reasons.push(row);
    });
    query = client.query('SELECT p.name, p.city_id, p.id FROM places as p');
    places = [];
    query.on("row", function(row) {
      return places.push(row);
    });
    query = client.query('SELECT c.city, c.id FROM cities as c');
    cities = [];
    query.on("row", function(row) {
      return cities.push(row);
    });
    return query.on("end", function() {
      return callback(reasons, places, cities);
    });
  };

  Form = (function() {
    function Form() {}

    Form.list = function(callback) {
      var forms, query;

      forms = [];
      query = client.query("SELECT r.name AS reason, p.name AS place, c.city AS city, f.title, f.filename, f.is_pediatric\nFROM\nreasons as r, places as p, forms as f, cities as c\nWHERE\nf.reason_id = r.id AND f.place_id = p.id AND p.city_id = c.id;");
      query.on("row", function(row) {
        return forms.push(row);
      });
      return query.on("end", function() {
        return callback(forms);
      });
    };

    Form.view = function(name, callback) {
      var forms, query;

      forms = [];
      query = client.query("SELECT r.name AS reason, p.name AS place, c.city AS city, f.title, f.filename, f.is_pediatric\nFROM\nreasons as r, places as p, forms as f, cities as c\nWHERE\nf.reason_id = r.id AND f.place_id = p.id AND p.city_id = c.id AND f.filename = '" + name + "';");
      query.on("row", function(row) {
        return forms.push(row);
      });
      return query.on("end", function() {
        return callback(forms);
      });
    };

    Form.add = function(new_form) {
      var query;

      return query = client.query("INSERT INTO forms (title, is_pediatric, place_id, reason_id, filename) \nVALUES ('" + new_form.title + "', '" + new_form.is_ped + "', " + new_form.pid + ", " + new_form.rid + ", '" + new_form.filename + "');");
    };

    Form.del = function(id) {
      var query;

      return query = client.query("DELETE FROM forms WHERE filename='" + id + "';");
    };

    Form.update = function(form) {
      var query;

      return query = client.query("UPDATE forms(title,is_pediatric,reason_id,place_id) \nVALUES ('" + form.title + "','" + form.is_ped + "'," + form.reason + "," + form.inst + ")  WHERE forms.id = form.id;");
    };

    return Form;

  })();

  exports.Form = Form;

  City = (function() {
    function City() {}

    City.add = function(new_city) {
      var query;

      return query = client.query("INSERT INTO cities (city) \nVALUES ('" + new_city + "');");
    };

    City.add = function(id) {
      var query;

      return query = client.query("DELETE FROM city WHERE \nid = " + id);
    };

    return City;

  })();

  exports.City = City;

  Reason = (function() {
    function Reason() {}

    Reason.add = function(new_reason) {
      var query;

      return query = client.query("INSERT INTO reasons (name) \nVALUES ('" + new_reason + "');");
    };

    return Reason;

  })();

  Institution = (function() {
    function Institution() {}

    Institution.add = function(new_place) {
      var query;

      return query = client.query("INSERT INTO places (name, city_id) \nVALUES ('" + new_place.name + "', " + new_place.city_id + ");");
    };

    return Institution;

  })();

  exports.Search = function(callback) {
    var query, results;

    query = client.query('SELECT r.name, p.name, c.city, f.title, f.filename, f.is_pediatric\nFROM\nreasons as r, places as p, forms as f, cities as c\nWHERE\nf.reason_id = r.id AND f.place_id = p.id AND p.city_id = c.id;');
    results = [];
    query.on("row", function(row) {
      return results.push(row);
    });
    return query.on("end", function() {
      return callback(results);
    });
  };

}).call(this);
