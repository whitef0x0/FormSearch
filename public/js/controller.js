// Generated by CoffeeScript 1.6.2
(function() {
  $(document).ready(function() {
    var fireDownload, places, source;

    $('#myModal').modal({
      show: false
    });
    /*
    $("#modify").ajaxForm () ->
      @.html("Form updated successfully!")
    */

    if ($("#template").length !== 0) {
      source = $("#template").html();
      window.template = Handlebars.compile(source);
      String.prototype.trim = function() {
        return this.replace(/^\s+|\s+$/g, '');
      };
    }
    places = {};
    $.get('/api/places', function(rsp) {
      return places = rsp;
    });
    $("#city").change(function() {
      var context, curr_id, html, out_places, place, _i, _len;

      curr_id = $("#city").find(":selected").val();
      out_places = [];
      for (_i = 0, _len = places.length; _i < _len; _i++) {
        place = places[_i];
        if (place.city_id + '' === curr_id) {
          out_places.push(place);
        }
      }
      context = {
        places: out_places
      };
      html = typeof template === "function" ? template(context) : void 0;
      return $("#institution").html(html);
    }).trigger("change");
    $(".showmenu").click(function(e) {
      var id;

      id = e.target.id;
      $("#" + id + ".menu").toggle("fold");
      return $("#" + id + " > i.icon-chevron-right").toggleClass("icon-rotate-90");
    });
    $(".print").printPage({
      attr: "href",
      message: "Preparing document for printing"
    });
    fireDownload = function() {
      var filename, path;

      filename = location.pathname.replace("/view:", "");
      path = "http://127.0.0.1:3001/static/" + filename + ".pdf";
      return window.location.assign(path);
    };
    return $("#download").click(function() {
      $.ajaxSetup({
        beforeSend: function(xhr) {
          return xhr.setRequestHeader("Content Type: application/octet-stream", "Content-Disposition: attachment; filename=" + filename + ".pdf");
        }
      });
      return fireDownload();
    });
  });

}).call(this);
