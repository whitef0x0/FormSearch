// Generated by CoffeeScript 1.6.2
(function() {
  var results, source, template;

  source = $("#entry-template").html();

  template = Handlebars.compile(source);

  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, '');
  };

  results = {};

  $("#upload").click(function() {
    return $.get("/upload", function(data) {
      $("#search").hide();
      console.log(data);
      return $(".container").html(data);
    });
  });

  $("#omnibox").keyup(function() {
    var context, html, out_results, result, term, terms, _i, _j, _len, _len1;

    terms = $(this).val().trim().split(" ");
    out_results = [];
    for (_i = 0, _len = results.length; _i < _len; _i++) {
      result = results[_i];
      result.score = 0;
      for (_j = 0, _len1 = terms.length; _j < _len1; _j++) {
        term = terms[_j];
        if (!term) {
          continue;
        }
        term = term.toLowerCase();
        if (result.name.toLowerCase().indexOf(term) > -1) {
          result.score += 1;
        }
        if (result.city.toLowerCase().indexOf(term) > -1) {
          result.score += 1;
        }
        if (result.title.toLowerCase().indexOf(term) > -1) {
          result.score += 1;
        }
      }
      if (result.score > 0) {
        out_results.push(result);
      }
    }
    out_results.sort(function(a, b) {
      return b.score - a.score;
    });
    context = {
      results: out_results
    };
    html = template(context);
    $(".results").html(html);
    return $.get('/api/results', function(rsp) {
      return results = rsp;
    });
  });

}).call(this);

/*
//@ sourceMappingURL=controller.map
*/
